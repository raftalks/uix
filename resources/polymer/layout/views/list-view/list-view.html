<dom-module id="list-view">

    <template>
        <style>
            :host {
                display: block;
            }

            paper-scroll-header-panel {
                height: 100%;
            }

            paper-scroll-header-panel paper-toolbar {
                background-image: url('/vendor/raftalks/uix/images/modern_material.jpg');
                background-position:25% 75%;
                background-attachment: fixed;
            }

            paper-drawer-panel {
                top: auto !important;
            }

            .list-container {
                /*@apply(--layout-fit);*/
                min-height:300px;
                height:auto;
            }

            .list-panel {
                --paper-scroll-header-container: {
                    border-right: 1px solid #ccc;
                };
            }

            .list-panel paper-toolbar .title {
                margin-left:0px;
            }


            .list-view-container {
                display: flex;
                flex-direction: column;
                padding: 8px;
            }

            paper-fab.bottom-right{
                position: absolute;
                bottom: 16px;
                right: 16px;
            }



            .list-item {
                @apply(--layout-horizontal);
                cursor: pointer;
                height: 80px;
                padding: 16px 22px;
                border-bottom: 1px solid #DDD;
            }

            .list-item:focus,
            .list-item.selected:focus {
                outline: 0;
                background-color: #ddd;
            }

            .list-item.selected {
                background-color: var(--google-grey-300);
                border-bottom: 1px solid #ccc;
            }

            .list-item .avatar {
                height: 40px;
                width: 40px;
                border-radius: 20px;
                box-sizing: border-box;
                background-color: #ddd;
            }

            .list-item .pad {
                @apply(--layout-flex);
                @apply(--layout-vertical);
                padding: 0 16px;
            }

            .list-item .primary {
                font-size: 16px;
            }
            .list-item .secondary {
                font-size: 14px;
            }
            .list-item .dim {
                color: gray;
            }



        </style>

        <iron-media-query query="(min-width: 1024px)" query-matches="{{largeScreen}}"></iron-media-query>
        <iron-media-query query="(min-width: 1280px)" query-matches="{{largeDesktopScreen}}"></iron-media-query>

        <iron-ajax
                auto
                url="{{ ajaxUrl }}"
                handle-as="json"
                last-response="{{items}}"
                debounce-duration="300"></iron-ajax>

            <paper-drawer-panel right-drawer id="drawerLayout" responsive-width="1024px" drawer-toggle-attribute="list-toggle">

                    <paper-scroll-header-panel id="scrollheaderpanel" main class="list-panel" fixed="{{largeDesktopScreen}}" condenses="1" condensed-header-height="64">

                        <paper-toolbar class="medium-tall">
                            <div hidden$="[[!title]]" class="bottom title">[[ title ]]</div>
                        </paper-toolbar>

                        <iron-list class="list-container" items="[[items]]" as="item" selected-item="{{selectedItem}}" selection-enabled >
                            <template>
                                <div tabindex$="[[tabIndex]]" aria-label$="Select/Deselect [[item.label]]" class$="[[_computedListItemClass(selected)]]" on-tap="_listTap">
                                    <img class="avatar" src="https://randomuser.me/api/portraits/thumb/men/10.jpg">
                                    <div class="pad">
                                        <div class="primary">
                                            [[item.name]]
                                        </div>
                                        <div class="secondary dim">[[item.email]]</div>
                                    </div>
                                </div>
                                <div class="border"></div>
                            </template>
                        </iron-list>


                    </paper-scroll-header-panel>

                    <paper-fab icon="add" class="bottom-right" elevation="1"></paper-fab>


                <paper-scroll-header-panel drawer fixed="{{largeDesktopScreen}}" condenses="1" condensed-header-height="64">
                    <paper-toolbar class="medium-tall">
                        <paper-icon-button icon="arrow-back" list-toggle hidden$="{{largeScreen}}"></paper-icon-button>
                    </paper-toolbar>
                    <div class="list-view-container">
                        <template is='dom-if' if="{{ itemSelected }}">
                            <h2>[[selectedItem.name]]</h2>
                        </template>
                        <template is='dom-if' if="{{ ! itemSelected }}">
                            <h2>No item selected</h2>
                        </template>
                    </div>
                </paper-scroll-header-panel>
            </paper-drawer-panel>

    </template>

    <script>
        Polymer({
            is: 'list-view',

            properties: {
                title : String,
                largeScreen: {
                    type: Boolean,
                    value: false,
                    observer: 'onScreenSizeChange'

                },
                selectedItem: {
                    type: Object,
                    value: null,
                    observer: 'onSelectedItemChanged'
                },

                items : {
                    type: Array,
                    value: []
                },
                ajaxUrl: {
                    type: String,
                    value: "http://homestead.dev/list"
                }
            },


            ready: function()
            {
                this.itemSelected = false;
                console.log('ajax url:'+this.ajaxUrl);
            },

            onScreenSizeChange : function(isLargeScreen)
            {

                var drawer = this.$.drawerLayout;

                if(isLargeScreen)
                {
                    drawer.setAttribute('drawer-width', '60%');
                }
                else
                {
                    drawer.setAttribute('drawer-width', '100%');
                }
            },

            onSelectedItemChanged : function(selectedItem)
            {
                if(selectedItem === null)
                {
                    this.itemSelected = false;
                }
                else {
                    this.itemSelected = true;
                }
            },

            _listTap : function() {

                this.$.drawerLayout.openDrawer();
            },

            _computedListItemClass : function(isSelected) {
                var classes = 'list-item';
                if (isSelected) {
                    classes += ' selected';
                }
                return classes;
            }

        });
    </script>

</dom-module>